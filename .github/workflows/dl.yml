name: Update data

on:
  workflow_dispatch: # Manual trigger
  schedule:
    - cron: "0 */4 * * *" # Every 4 hours

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4

      # nba.com doesn't let me use a github actions IP, so route through tailscale
      # https://til.simonwillison.net/tailscale/tailscale-github-actions
      - name: Setup Tailscale
        uses: tailscale/github-action@v3
        with:
          oauth-client-id: ${{ secrets.TAILSCALE_OAUTH_CLIENT_ID }}
          oauth-secret: ${{ secrets.TAILSCALE_OAUTH_SECRET }}
          args: "--exit-node=apple-tv --exit-node-allow-lan-access=true"
          tags: tag:github-actions

      - name: Install uv
        uses: astral-sh/setup-uv@v5

      - name: Configure Git
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      - name: Run update
        run: make update
